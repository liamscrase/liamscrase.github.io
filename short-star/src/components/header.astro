---
const currentPath = Astro.url.pathname;
---

<nav>
  <div class="inner">
    <a class="logo" href="/">LIAM</a>
    <ul>
      <li><a href="/#projects">Projects</a></li>
      <li><a href="/#site-footer">Contact</a></li>
    </ul>
  </div>
</nav>

<script>
  // @ts-nocheck
  document.addEventListener("DOMContentLoaded", () => {
    const nav = document.querySelector("nav");
    let ticking = false;
    let isScrolled = false;

    const scrollToElement = (el, offset = 0) => {
      const y = el.getBoundingClientRect().top + window.scrollY - offset;
      window.scrollTo({ top: y, behavior: "smooth" });
    };

    window.addEventListener("scroll", () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          const shouldBeScrolled = window.scrollY > 10;
          if (shouldBeScrolled !== isScrolled) {
            isScrolled = shouldBeScrolled;
            nav?.classList.toggle("scrolled", isScrolled);
          }
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });

    // Smooth scroll on load if hash present
    const hash = window.location.hash.slice(1);
    if (hash) {
      setTimeout(() => {
        const target = document.getElementById(hash);
        if (target) scrollToElement(target, hash === "projects" ? 100 : 0);
      }, 100);
    }

    // Smooth scroll on hash link click (same-page only)
    document.querySelectorAll('a[href*="#"]').forEach((link) => {
      link.addEventListener("click", (e) => {
        const href = link.getAttribute("href");
        const hash = href?.split("#")[1];
        if (!hash) return;

        const target = document.getElementById(hash);
        if (!target) return; // let browser handle cross-page navigation

        e.preventDefault();
        scrollToElement(target, hash === "projects" ? 100 : 0);
        history.pushState(null, "", href);
      });
    });
  });
</script>